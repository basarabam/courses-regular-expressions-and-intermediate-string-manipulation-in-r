---
title: Insert title here
key: b830b2075b68dfb75dfcbf2e59156135

---
## 2.4. Replacing strings using regular expressions

```yaml
type: "TitleSlide"
key: "9d82d87138"
```

`@lower_third`

name: Milos Basaraba
title: Data Scientist


`@script`
Welcome back!
In the final section of this chapter it's time to learn and practice how to apply string replacement to a real world problems, with Regular Expressions.
String replacement might save you a lot of time, especially in combination with regular expressions.


---
## Stringr

```yaml
type: "FullSlide"
key: "53619ffa4f"
code_zoom: 93
```

`@part1`
```str_replace()``` and ```str_replace_all()``` {{0}}

``` 
str <- c("football", "basketball", "tennis", “voleyball“)
pattern = "[aeiou]"
replacement = "_"
str_replace(str, pattern, replacement)
```{{1}}

```
[1] "f_otball"   "b_sketball" "t_nnis"     "v_leyball"
```{{2}}

``` 
str_replace_all(str, pattern, replacement)
``` {{3}}

```[1] "f__tb_ll"   "b_sk_tb_ll" "t_nn_s"     "v_l_yb_ll"
```{{4}}


`@script`
As in the previous lessons, first we are going to talk about Stringr functions for replacing strings. 
The most usual tasks with strings could be done with stringr package, it has very simply syntax and it is easy to learn
Stringr package has two functions for replacing strings. 
str_replace()
str_replace_all()
Both functions takes three arguments
Input vector - Either a character vector, or something coercible to character vector.
Pattern - Pattern to look for. Pattern can be a string or regular expression.
Replacement - A character vector of replacements. Vector of replacements should be either length one, or the same length as string or pattern, or strange behavior may occur.
Replacement argument may take named vector or function for performing multiple replacements.
Imagine the situation, that you get the task to remove all vowels from the name of different sports. It is necessary for some letter guessing  game in the quiz, your company produces. You can do it by hand, but in that case, you are going to loose whole day on that task. If you have the list of sports, that is not a problem at all. You are going to do the task for 2 minutes, using stringr package using str_replace() function! 
You are having the str character vector containing names of some sports, for testing purpose
In the testing phase, first you are going to test the str_replace function, with regular expression for vowels, and replace vowels with underscores.
First, you are going to define a character class of vowels in a form of regular expression, as the pattern variable. In this case, you are going to use square brackets, to define characters which you want to include in your search pattern.
Then you are going to define a desired replacement variable, in this case it would be the underscore.

Ops, that is not desired output. But don't worry, the function str_replace matches only the first pattern in the string, what can be useful in many other cases.
You can use str_replace_all() function, with the same arguments, and it will do the work. This function will replace all vowels in the character vector.
Suddenly, your boss tells you that you have to remove consonants from the sting. No problem!, you can do it by entering all consonants inside the square brackets as the pattern. 
But wait, there is even easier and faster way. It is called negation in regular expression syntax.


---
## Negation

```yaml
type: "FullSlide"
key: "35c11a48ab"
code_zoom: 87
```

`@part1`
- **Negation**  ```[^...]```{{1}}
- Leading ```^``` negates the list ```[...]```{{2}}
- Don't mix up with start of the line caret ```^```{{3}}
- Totaly different meaning in the list ```[^...]```{{4}}
- Only when it is immediately after the class's opening bracket {{5}}
```
> str_replace(str, "[^aeiou]", "_")
[1] "_ootball"   "_asketball" "_ennis"     "_oleyball"{{6}}
```

```
> str_replace_all(str, "[^aeiou]", "_")
[1] "_oo__a__"   "_a__e__a__" "_e__i_"     "_o_e__a__"
```{{7}}


`@script`
If you use caret inside the square brackets the class matches any character that isn't listed.
The lading caret in the class negates the list, so rather than listing the characters you want to include
in the class, you list the characters you don't want to be included.
Don't mix up caret at the with the start-of-line caret, in the square brackets, in the beginning it has totally different meaning.


---
## Multiple replacements

```yaml
type: "FullSlide"
key: "fe76ca9ba0"
code_zoom: 60
```

`@part1`
With ```str_replace_all()``` you can perform multiple replacements by **supplying a named vector**{{1}}
```
str <- c("4 friends", "2 bars", "30 beers", "4 hangovers")
str_replace_all(str, c("4" = "four", "2" = "two", "30" = "thirty", "4" = "hangovers"))
```{{2}}

```
[1] "four friends"   "two bars"       "thirty beers"   "four hangovers"
```{{3}}


`@script`
In the str_replace functions, you can perform multiple replacements by supplying named vector like.
So don't celebrate too much, your new knowledge.


---
## Inserting components of the match

```yaml
type: "FullSlide"
key: "4de64cc29d"
code_zoom: 85
```

`@part1`
Instead of replacing with a fixed string, you can use **backreferences** to insert components of the match {{1}}
```
sentences <- c("The canoe birch slid on the smooth planks." 
, "Glue sheet the to the dark blue background."
, "It's to easy tell the depth of a well.")

str_replace(sentences, "([^ ]+) ([^ ]+) ([^ ]+)", "\\1 \\3 \\2")
```{{2}}

```
[1] "The birch canoe slid on the smooth planks."
[2] "Glue the sheet to the dark blue background."
[3] "It's easy to tell the depth of a well."
```{{3}}


`@script`
In the following code example, the order of the second and third words is flipped, with backreference what would be discussed in the next chapter of these course.


---
## Matching with functions

```yaml
type: "FullSlide"
key: "75ca73b041"
code_zoom: 75
```

`@part1`
It is possible to use replacement argument as the function
```
str_replace_all(sentences, "[aeiou]", toupper)
```

```
[1] "ThE cAnOE bIrch slId On thE smOOth plAnks."
[2] "GlUE shEEt thE tO thE dArk blUE bAckgrOUnd."
[3] "It's tO EAsy tEll thE dEpth Of A wEll."
```
or to change pattern to NA values
```
str_replace_all(sentences, "b", NA_character_)
```

```
[1] NA                                       
[2] NA                                       
[3] "It's to easy tell the depth of a well."
```


`@script`
With str_replacement functions you can use functions to do replacements, or to replace patterns with NA values, like in the example.


---
## Stringi replacing

```yaml
type: "FullSlide"
key: "c2fab64bf2"
code_zoom: 85
```

`@part1`
- These functions replace, with the given replacement string, every/first/last substring of the input that matches the specified pattern.
- Many different options for fine tuning in replacement process

```
stri_replace_*_*
```

```
> stri_replace_all_charclass("aaaa", "[a]", "b", merge=FALSE)
[1] "bbbb"
```

```
> stri_replace_all_charclass("aaaa", "[a]", "b", merge = TRUE)
[1] "b"
```


`@script`
Stringi package provides huge number of functions for replacing strings.
Stringi functions replace, with the given replacement string first or last or every substring of the input that matches the specified pattern.
In the example you can see how different value for match can influence on results.


---
## Stringi replacing with or without vectorizing

```yaml
type: "FullSlide"
key: "b632590873"
code_zoom: 70
```

`@part1`
- single logical value; should each occurrence of a pattern in every string be replaced by a corresponding replacement string?;
- ```stri_replace_all_*``` only!

```
> stri_replace_all_fixed("The quick brown fox jumped over the lazy dog.",
c("quick", "brown", "fox"), c("slow",  "black", "bear"), vectorize_all=TRUE)
[1] "The slow brown fox jumped over the lazy dog."
"The quick black fox jumped over the lazy dog." 
[3] "The quick brown bear jumped over the lazy dog."
```

```
> stri_replace_all_fixed("The quick brown fox jumped over the lazy dog.",
c("quick", "brown", "fox"), c("slow",  "black", "bear"), vectorize_all=FALSE)
[1] "The slow black bear jumped over the lazy dog."
```
- many different functions with a lot of options, for replacing strings


`@citations`
Stringi functions


`@script`
Also, example of using option vectorize_all in stri_replace_all_*() function family gives different results of the function. In the example where the vectorize_all argument is set to TRUE, the replacement vector iterates through string according to pattern, and gives three sentences. On the other hand, if vectorize_all is set to FALSE, all replacements implements at once.


---
## Let's practice!

```yaml
type: "FinalSlide"
key: "a7ec146d9b"
```

`@script`
See you in the next chapter after you successfully do the practical exercises. Happy stringing

